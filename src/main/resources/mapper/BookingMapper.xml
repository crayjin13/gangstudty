
	
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.jts.gangstudy.mapper.BookingMapper">
	<!-- 예약 추가 -->
	<insert id="insertBook" parameterType="com.jts.gangstudy.domain.Booking">
	  INSERT INTO BOOKING_TB
	  (USER_NO, ROOM_NO, CHECK_IN, CHECK_OUT, PEOPLE, STATE, REQUEST_DT) VALUES
	  (#{user_no}, #{room_no}, TO_DATE(#{check_in}, 'YYYY-MM-DD HH24:MI'), TO_DATE(#{check_out}, 'YYYY-MM-DD HH24:MI'), #{people}, #{state}, SYSDATE)
	</insert>
	<!-- 예약 삭제 -->
	<select id="deleteBook" parameterType="int" resultType="com.jts.gangstudy.domain.Booking">
	  DELETE FROM BOOKING_TB
	  WHERE BOOK_NO = #{book_no}
	</select>
	<!-- 전체 내용 조회 -->
	<select id="selectAll" resultType="com.jts.gangstudy.domain.Booking">
	  SELECT BOOK_NO, USER_NO, ROOM_NO, TO_CHAR(CHECK_IN, 'YYYY-MM-DD HH24:MI') AS CHECK_IN, TO_CHAR(CHECK_OUT, 'YYYY-MM-DD HH24:MI') AS CHECK_OUT, PEOPLE, STATE, TO_CHAR(REQUEST_DT, 'YYYY-MM-DD')
	  FROM BOOKING_TB
	</select>
	<!-- 지정된 날짜의 예약 목록 조회 -->
	<select id="selectDate" parameterType="String" resultType="com.jts.gangstudy.domain.Booking">
	  SELECT BOOK_NO, USER_NO, ROOM_NO, TO_CHAR(CHECK_IN, 'YYYY-MM-DD HH24:MI') AS CHECK_IN, TO_CHAR(CHECK_OUT, 'YYYY-MM-DD HH24:MI') AS CHECK_OUT, PEOPLE, STATE, TO_CHAR(REQUEST_DT, 'YYYY-MM-DD')
	  FROM BOOKING_TB
	  WHERE TO_CHAR(CHECK_IN, 'YYYY-MM-DD') = #{date} OR TO_CHAR(CHECK_OUT, 'YYYY-MM-DD') = #{date}
	</select>
	
	<!-- 유저의 모든 예약 조회 -->
	<select id="viewUser" parameterType="int" resultType="com.jts.gangstudy.domain.Booking">
	  SELECT BOOK_NO, USER_NO, ROOM_NO, TO_CHAR(CHECK_IN, 'YYYY-MM-DD HH24:MI') AS CHECK_IN, TO_CHAR(CHECK_OUT, 'YYYY-MM-DD HH24:MI') AS CHECK_OUT, PEOPLE, STATE, TO_CHAR(REQUEST_DT, 'YYYY-MM-DD')
	  FROM BOOKING_TB
	  WHERE USER_NO = #{user_no}
	</select>
	
	<!-- 유저의 특정상태의 예약 조회 -->
	<select id="viewUserState" parameterType="hashmap" resultType="com.jts.gangstudy.domain.Booking">
	  SELECT BOOK_NO, USER_NO, ROOM_NO, TO_CHAR(CHECK_IN, 'YYYY-MM-DD HH24:MI') AS CHECK_IN, TO_CHAR(CHECK_OUT, 'YYYY-MM-DD HH24:MI') AS CHECK_OUT, PEOPLE, STATE, TO_CHAR(REQUEST_DT, 'YYYY-MM-DD')
	  FROM BOOKING_TB
	  WHERE USER_NO = TO_NUMBER(#{user_no}) AND STATE = #{state}
	</select>
	
	<!-- 예약시간 중복 확인-->
	<select id="checkDuplicate" parameterType="hashmap" resultType="int">
	  SELECT count(*) cnt
	  FROM BOOKING_TB
	  <![CDATA[
	  WHERE CHECK_IN < TO_DATE(#{check_out}, 'YYYY-MM-DD HH24:MI') AND CHECK_OUT > TO_DATE(#{check_in}, 'YYYY-MM-DD HH24:MI')
	  ]]>
	</select>
	
	<!-- 날짜를 걸친 예약 조회 -->
	<select id="viewOvernight" parameterType="string" resultType="com.jts.gangstudy.domain.Booking">
	  SELECT BOOK_NO, USER_NO, ROOM_NO, TO_CHAR(CHECK_IN, 'YYYY-MM-DD HH24:MI') AS CHECK_IN, TO_CHAR(CHECK_OUT, 'YYYY-MM-DD HH24:MI') AS CHECK_OUT, PEOPLE, STATE, TO_CHAR(REQUEST_DT, 'YYYY-MM-DD')
	  FROM BOOKING_TB
	  WHERE TO_CHAR(CHECK_IN, 'YYYY-MM-DD') = #{date} AND TO_CHAR(CHECK_OUT, 'YYYY-MM-DD') != #{date}
	</select>
	
	
</mapper>